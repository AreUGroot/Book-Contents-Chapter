/* ── Reset & Base ── */
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; color: #333; background: #e8e8e8; }

/* ── Toolbar ── */
#toolbar {
    display: flex; align-items: center; justify-content: space-between;
    height: 44px; padding: 0 12px; background: #2c2c2c; color: #eee;
    border-bottom: 1px solid #1a1a1a; user-select: none; flex-shrink: 0;
}
.toolbar-left, .toolbar-right { display: flex; align-items: center; gap: 8px; }
.toolbar-divider { width: 1px; height: 22px; background: #555; margin: 0 4px; }

/* ── Buttons ── */
.btn {
    padding: 5px 12px; border: 1px solid #555; border-radius: 4px;
    background: #3c3c3c; color: #ddd; cursor: pointer; font-size: 13px;
    white-space: nowrap; transition: background 0.15s;
}
.btn:hover { background: #4a4a4a; }
.btn-primary { background: #1976d2; border-color: #1565c0; color: #fff; }
.btn-primary:hover { background: #1565c0; }
.btn-icon { width: 30px; padding: 5px 0; text-align: center; font-weight: bold; font-size: 16px; }
.btn-back { text-decoration: none; display: inline-block; }
.btn-sm { padding: 3px 10px; font-size: 12px; }

/* ── Page inputs ── */
.page-input { width: 60px; padding: 4px 6px; border: 1px solid #555; border-radius: 3px; background: #3c3c3c; color: #eee; font-size: 13px; text-align: center; }
.page-input:focus { outline: none; border-color: #1976d2; }

/* ── Zoom select ── */
.zoom-select { padding: 4px 6px; border: 1px solid #555; border-radius: 3px; background: #3c3c3c; color: #eee; font-size: 13px; }

/* ── Page info ── */
#pageInfo { font-size: 13px; min-width: 70px; text-align: center; }

/* ── TOC link ── */
.toc-link { color: #64b5f6; font-size: 13px; cursor: pointer; text-decoration: underline; margin-left: 6px; }
.toc-link:hover { color: #90caf9; }

/* ── Main layout ── */
#main { display: flex; height: calc(100vh - 44px); overflow: hidden; }

/* ── Sidebar ── */
#sidebar {
    width: 280px; min-width: 180px; max-width: 500px;
    background: #fafafa; border-right: 1px solid #ddd;
    display: flex; flex-direction: column; overflow: hidden; flex-shrink: 0;
}
#sidebarHeader {
    display: flex; align-items: center; justify-content: space-between;
    padding: 10px 12px; font-weight: 600; font-size: 14px;
    background: #f0f0f0; border-bottom: 1px solid #ddd;
}
#outlineTree { flex: 1; overflow-y: auto; padding: 8px 0; font-size: 13px; }

/* ── Outline tree ── */
.outline-item { cursor: pointer; user-select: none; }
.outline-row {
    display: flex; align-items: center; padding: 4px 8px; gap: 4px;
    transition: background 0.1s;
}
.outline-row:hover { background: #e3f2fd; }
.outline-toggle {
    width: 18px; height: 18px; display: inline-flex; align-items: center; justify-content: center;
    font-size: 10px; color: #666; flex-shrink: 0; border-radius: 3px;
}
.outline-toggle:hover { background: #d0d0d0; }
.outline-toggle.leaf { visibility: hidden; }
.outline-title {
    flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    color: #1565c0; line-height: 1.4;
}
.outline-page { color: #999; font-size: 11px; flex-shrink: 0; margin-left: 4px; }
.outline-children { display: none; }
.outline-children.expanded { display: block; }

/* indent levels */
.outline-item[data-level="1"] .outline-row { padding-left: 8px; }
.outline-item[data-level="2"] .outline-row { padding-left: 26px; }
.outline-item[data-level="3"] .outline-row { padding-left: 44px; }
.outline-item[data-level="4"] .outline-row { padding-left: 62px; }

/* ── Resizer ── */
#resizer {
    width: 5px; cursor: col-resize; background: #ddd;
    transition: background 0.15s; flex-shrink: 0;
}
#resizer:hover, #resizer.active { background: #1976d2; }

/* ── Show sidebar button ── */
.btn-show-sidebar {
    position: absolute; left: 0; top: 50%; transform: translateY(-50%);
    z-index: 10; width: 20px; height: 60px; border: 1px solid #ccc;
    border-left: none; border-radius: 0 4px 4px 0;
    background: #f0f0f0; cursor: pointer; font-size: 12px; color: #666;
    display: flex; align-items: center; justify-content: center;
}
.btn-show-sidebar:hover { background: #e0e0e0; }

/* ── Viewer ── */
#viewerContainer { flex: 1; overflow: auto; background: #e8e8e8; position: relative; }
#viewer { display: flex; flex-direction: column; align-items: center; padding: 10px 0; }
.page-wrapper {
    margin: 5px 0; background: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    position: relative;
}
.page-wrapper canvas { display: block; }
.page-placeholder { background: #f0f0f0; }

/* ── Text layer (for text selection) ── */
.textLayer {
    position: absolute; inset: 0; overflow: hidden;
    opacity: 0.25; line-height: 1;
}
.textLayer > span {
    color: transparent; position: absolute; white-space: pre;
    transform-origin: 0% 0%;
}
.textLayer ::selection { background: rgba(0, 0, 255, 0.3); }
.textLayer ::-moz-selection { background: rgba(0, 0, 255, 0.3); }

/* ── Modal ── */
.modal {
    position: fixed; inset: 0; z-index: 100;
    background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
}
.modal-content {
    background: #fff; border-radius: 8px; width: 560px; max-height: 80vh;
    display: flex; flex-direction: column; overflow: hidden;
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
}
.modal-large { width: 85vw; max-width: 1200px; height: 85vh; max-height: 85vh; }
.modal-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 16px; background: #f5f5f5; border-bottom: 1px solid #ddd;
    font-weight: 600; font-size: 15px;
}
.btn-close { background: none; border: none; font-size: 22px; cursor: pointer; color: #666; padding: 0 4px; }
.btn-close:hover { color: #333; }
.modal-toolbar { display: flex; align-items: center; gap: 10px; padding: 10px 16px; border-bottom: 1px solid #eee; }
.modal-viewer { flex: 1; overflow: auto; background: #e8e8e8; display: flex; flex-direction: column; align-items: center; padding: 10px 0; }
.modal-body { padding: 16px; overflow-y: auto; flex: 1; }
.status-text { font-size: 13px; color: #666; }
.status-text.error { color: #d32f2f; }
.status-text.success { color: #2e7d32; }

/* ── Chapter list ── */
.chapter-list { margin: 12px 0; max-height: 400px; overflow-y: auto; }
.chapter-item { display: flex; align-items: center; gap: 8px; padding: 8px 10px; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
.chapter-item:hover { background: #f5f5f5; }
.chapter-item input { flex-shrink: 0; }
.chapter-page { color: #999; font-size: 12px; margin-left: auto; }
.split-actions { display: flex; gap: 8px; margin-bottom: 8px; }
.split-footer { display: flex; align-items: center; gap: 12px; margin-top: 12px; }

/* ── Loading overlay ── */
#loadingOverlay {
    position: fixed; inset: 0; z-index: 200;
    background: rgba(255,255,255,0.85); display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 16px;
}
.spinner {
    width: 36px; height: 36px; border: 3px solid #ddd; border-top-color: #1976d2;
    border-radius: 50%; animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
#loadingText { font-size: 14px; color: #555; }

/* ── Utility ── */
.hidden { display: none !important; }
